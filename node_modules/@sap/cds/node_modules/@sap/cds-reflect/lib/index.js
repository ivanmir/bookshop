const $=require;  require = (id)=> lazy=> $(id)  // eslint-disable-line
const c = lazy => cds.builtin.classes [lazy]
const cds = module.exports = {

	Association:c,
	Composition:c,
	context:c,
	service:c,
	entity:c,
	struct:c,
	array:c,

	reflect: require ('./reflect'),
	linked: require ('./linked'),
	builtin: require ('./types'),

	clone:m => JSON.parse (JSON.stringify(m)),

    lazify (o=this) {
        const $ = Reflect.defineProperty
        for (let p of Reflect.ownKeys(o)) {
            let v = Reflect.getOwnPropertyDescriptor(o,p).value
            if (/^((function )?\w*\()?lazy/.test(v)) $(o,p, { configurable:1,
                get( ){ $(o,p,{writeable:1, value:v=v(p,o)}); return v },
                set(v){ $(o,p,{writeable:1, value:v}); return v },
            })
        }
        return o
    }
}
cds.lazify()