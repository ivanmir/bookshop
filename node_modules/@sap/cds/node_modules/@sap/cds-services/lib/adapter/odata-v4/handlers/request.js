const request = (uaa = {}) => {
  return (req, res, next) => {
    /*
    * .on('request') is the only possibility to set a shared object,
    * that can be used in ATOMICITY_GROUP_START and ATOMICITY_GROUP_END
    */
    if (req.getUrlObject().path.includes('$batch')) {
      req.setApplicationData({
        doNotFinishTransaction: true,
        req: req._inRequest
      })
    }

    next()
  }
}

module.exports = request
