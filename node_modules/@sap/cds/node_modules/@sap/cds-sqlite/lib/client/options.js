const {IllegalFunctionArgumentError} = require('@sap/cds-sql').errors

/**
 * Validates the connect and pool options and adds defaults if not given.
 * @param {Object} [options] - The db connection options.
 * @param {Object} [options.url] - Connect url with driver.
 * @param {Object} [options.database] - Alias for url.
 * @param {Object} [options.driver] - Package ID of driver facade.
 * @param {string} [options.host] - Filename to the database or :memory: for in memory
 * @param {string} [options.user] - Username for authentication
 * @param {string} [options.password] - Password for authentication
 * @param {Object} [options.pool] - The min and max pool options.
 * @param {number} [options.pool.min] - The minimum number of db connection clients.
 * @param {number} [options.pool.max] - The maximum number of db connection clients.
 * @throws {Error} If pool is set up with more than one client in ':memory' case
 */
const options = (options) => {
  options.host = options.host || options.database || options.url || ':memory:'

  options.pool.min = options.pool.min || 1
  options.pool.max = options.pool.max || ((options.host === ':memory:') ? 1 : 10)

  if (options.host === ':memory:' && options.pool.max !== 1) {
    throw new IllegalFunctionArgumentError('pool')
  }
}

module.exports = options
