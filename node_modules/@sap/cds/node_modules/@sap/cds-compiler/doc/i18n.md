# i18n

There is provided a set of functionality when it comes to i18n activities regarding your model.
Below is shown a simple example of using it.

## Export transtable annotations

If in the model there are annotations relevant for translation they are suppossed to be marked as __localized__.

For example:
```
annotation A: localized String(10);
````

In addition to the __localized__ annotations, there is a predefined set of OData related annotations included
in the list of ones relevant for translation, e.g. __@Common.Label__.

Later in the model, those annotations can be applied to types:
```
@A: 'Dog'
type T1: Integer;
```

or used for annotating entities and/or elements:
```
@A: 'Cat'
entity E {
  @A: 'Mouse'
  a: Integer;
  c: {
    @Common.Label: 'Bunny'
    x: Integer;
    @A: 'Elephant'
    y: Integer;
  };
};

```

The compiler provides the functionality all those annotations value to be collected as an output in a form of [Java properties file](https://en.wikipedia.org/wiki/.properties).
This can be achieved with the command line option __-E__:
````
cdsv -E <path_to_cds_source>
````

or programmatically via the exported method:
````javascript
let cdsv = require('cdsv');

cdsv.compile([<path_to_the_model>]).then(cdsv.exportAnnotations).then(console.log);
````

If the following model is given:
````
annotation A: localized String(10);

@A: 'Dog'
type T1: Integer;

@A: 'Cat'
entity E {
  @A: 'Mouse'
  a: Integer;
  c: {
    x: Integer;
    @A: 'Elephant'
    y: Integer;
  };
};
````

The output after execution will be:
````
T1@A=Dog
E@A=Cat
E..a@A=Mouse
E..c.y@A=Elephant
````

As annotations in an action or a function can also be relevant for translation, if we have the following model:
````
annotation A: localized String(10);

service S {
  entity E {
  } actions {
    @A: 'Banana'
    function func1() returns Integer;
    action act(@A: 'Apple' p: Integer) returns String(10);
    function func2() returns {
      @A: 'Orange'
      a: Integer;
    };
  };
  @A: 'Potato'
  function unboundFunc1() returns Integer;
  action unboundAct(@A: 'Onion' p: Integer) returns String(10);
  function unboundFunc2() returns {
    @A: 'Tomato'
    a: Integer;
  };
};
````

After the export, the resulted properties will be:
````
S.E.$actions.func1@A=Banana
S.E.$actions.act.$param.p@A=Apple
S.E.$actions.func2.a@A=Orange
S.unboundFunc1@A=Potato
S.unboundAct.$param.p@A=Onion
S.unboundFunc2..a@A=Tomato
````

> In the Java Properties syntax the colon (':'), the whitespace (' ') and equal sign ('=') are reserved symbols for delimiters of
> the key and the value of a property, therefore if they are part of a composed key, they are escaped with a backslash ('\\').

## Translate a model

Once you have the properties file it can be translated to a desirable language. The compiler gives the opportunity to merge back the translated value into the model.
Let's have the following translated to German language annotations from the example above:

````
T1@A=Hund
E@A=Katze
E..a@A=Maus
E..c.y@A=Elefant
````

The translation of the model can be done via the CLI:
````
cdsv <path_to_the_model> <path_to_the_translated_properties_file>
````

or programmatically:
````javascript
let cdsv = require('cdsv');
let model = <path_to_the_cds_model>
let translations = <path_to_the_translated_properties_file>

cdsv.compile([model, translations]).then(cdsv.compactJson).then(console.log);
````

The result will contain all the annotations value replaced by the desired translated value:

````json
{
  "definitions": {
    "A": {
      "kind": "annotation",
      "length": 10,
      "localized": true,
      "type": "cds.String"
    },
    "E": {
      "@A": "Katze",
      "elements": {
        "a": {
          "@A": "Maus",
          "indexNo": 1,
          "type": "cds.Integer"
        },
        "c": {
          "elements": {
            "x": {
              "indexNo": 1,
              "type": "cds.Integer"
            },
            "y": {
              "@A": "Elefant",
              "indexNo": 2,
              "type": "cds.Integer"
            }
          },
          "indexNo": 2
        }
      },
      "kind": "entity"
    },
    "T1": {
      "@A": "Hund",
      "kind": "type",
      "type": "cds.Integer"
    }
  }
}
````

> Note that only one translation at a time is possible. The latest passed properties file in the chain will be taken in mind.
> At the time there is not an option for renaming the result file in with specific language suffix, e.g. _en_EN.

## SAP UI5 style translations(beta version)

SAPUI5 offers a way for handling relevant for translation texts via a so called
resource model. More information about the usage of it can be found on
the [SAPUI5 developer guide](https://sapui5.netweaver.ondemand.com).

Following module provides an option to extract strings values in UI5 style.
Let's take for example input the model:
````
annotation Animal: localized String(10);
annotation Size: localized String(10);

@Animal: 'Dog'
@Size: 'Big or small'
type T1: Integer;

@Animal: 'Cat'
@Size: 'Big or small'
entity E {
  @Animal: 'Mouse'
  @Size: 'Small'
  a: Integer;
  c: {
    x: Integer;
    @Animal: 'Elephant'
    @Size: 'Big'
    y: Integer;
  };
};
````

Using the CLI option:
````
cdsv <path_to_the_model> --export-annos-ui5-style <dir_where_result_files_to_be_located>
````

In the target directory, two files will be located after a successful compilation.
+ __definitions.json__ with the content
````json
{
  "definitions": {
    "Animal": {
      "kind": "annotation",
      "localized": true,
      "type": "cds.String",
      "length": 10
    },
    "Size": {
      "kind": "annotation",
      "localized": true,
      "type": "cds.String",
      "length": 10
    },
    "T1": {
      "kind": "type",
      "type": "cds.Integer",
      "@Animal": "{i18n>T1_Animal}",
      "@Size": "{i18n>T1_Size}"
    },
    "E": {
      "kind": "entity",
      "elements": {
        "a": {
          "indexNo": 1,
          "type": "cds.Integer",
          "@Animal": "{i18n>а_Animal}",
          "@Size": "{i18n>а_Size}"
        },
        "c": {
          "indexNo": 2,
          "elements": {
            "x": {
              "indexNo": 1,
              "type": "cds.Integer"
            },
            "y": {
              "indexNo": 2,
              "type": "cds.Integer",
              "@Animal": "{i18n>y_Animal}",
              "@Size": "{i18n>y_Size}"
            }
          }
        }
      },
      "@Animal": "{i18n>Е_Animal}",
      "@Size": "{i18n>Е_Size}"
    }
  }
}
````

+ and __i18n.properties__ file with the annotations values
````
T1_Animal=Dog
T1_Size=Big or small
E_Animal=Cat
E_Size=Big or small
a_Animal=Mouse
a_Size=Small
y_Animal=Elephant
y_Size=Big
````

### Limitations/Precautions

+ As mentioned in the [SAPUI5 documentation](https://sapui5.netweaver.ondemand.com/#docs/guide/df86bfbeab0645e5b764ffa488ed57dc.html):
`... Furthermore, i18n files only impact client-side application texts ...`
If this option is chosen for use, the UI model should be strictly derived from the logic relevant for the back-end.

+ The application may be structured on the basis of reuse models/microservices. In this case, if the
presentation part uses inherited annotations of a multiple time used module, translations of them should be
done several times in the UI instead of done once for the core module.

+ Extending in terms of CDX of a translated in UI5 style model will lead to inconsistency in it.

+ This logic is only applicable for SAPUI5/Fiori applications.
