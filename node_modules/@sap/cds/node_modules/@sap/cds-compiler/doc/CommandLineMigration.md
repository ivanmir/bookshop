# Command Line Migration

With revision 1.0.24, the CDS compiler offers a new command line interface `cdsc`. The old `cdsv` command line is
deprecated, will not be extended with new features, and will be removed in a subsequent release.

Please see `cdsc --help` for a description of the new command line options (snapshot of current version below).

```
$ cdsc --help

  Usage: cdsc [options] <file> ...

  Compile a CDS model given from the input files. Input files may be CDS source files (.cds), CSN
  model files (.json), property files for localized annotations (.properties) and XML files (.xml)
  for pre-processed ODATA annotations.

  General Options
    -h, --help              Display this help text and exit
    -w, --warning <level>   Show warnings up to <level> (0: Error, 1: Warnings (default), 2: Info)
    -v, --version           Display version number and exit

  Generation options (default if none given: generate original model as CSN to <stdout>)
    -o, --out <dir>         Place generated files in directory <dir>, default is "-" for <stdout>
    -H, --to-hana <flags>   Generate HANA CDS source, <flags> can be a comma-separated combination
                            of either "flat" or "deep" (default) for entity names, either "assocs"
                            (default) or "joins" for associations and any of "src,csn"
                              flat    : produce uppercased flattened HANA entity names with
                                        underscores
                              deep    : produce HANA entity names with dots and nested contexts
                                        as in CDL
                              assocs  : keep associations in HANA CDS as far as possible
                              joins   : transform associations to HANA CDS joins
                              src     : generate HANA CDS source files
                              csn     : generate "hana_csn.json" with HANA-preprocessed model
    -O, --to-odata <flags>  Generate ODATA metadata and annotations, <flags> can be a comma-
                            separated combination of "xml,json,separate,combined,csn" and either
                            "v2" (default) or "v4" version
                              v2      : Generate ODATA V2 output
                              v4      : Generate ODATA V4 output
                              xml     : generate XML output (separate or combined)
                              json    : generate JSON output (not available for V2)
                              separate: generate "<svc>_metadata.xml" and "<svc>_annotations.xml"
                              combined: generate "<svc>.xml"
                              csn     : generate "odata_csn.json" with ODATA-preprocessed model
    -C, --to-cdl            Generate CDS source
    -S, --to-swagger        Generate Swagger (OpenAPI) JSON
    -Q, --to-sql <flags>    Generate SQL DDL statements, <flags> can be a comma-separated
                            combination of either "flat" or "deep" (default) for entity names,
                            either "assocs" (default) or "joins" for associations and any of
                            "src,csn"
                              flat    : produce uppercased flattened table/view names with
                                        underscores
                              deep    : produce quoted table/view names with dots
                              assocs  : keep associations as far as possible (only usable for
                                        HANA SQL)
                              joins   : transform associations to SQL joins
                              src     : generate SQL source files
                              csn     : generate "sql_csn.json" with SQL-preprocessed model
    -I, --to-i18n <style>   Generate files for translation of localized annotations, <style> can
                            be either "prop" (default) for a property file or "ui5" for a UI5-
                            style combination of property file and modified model
                              prop    : generate property file with  annotation text
                              ui5     : generate model with placeholders and property file with
                                        annotation text
    -l, --lint-mode         Generate nothing, just produce single-file error messages if any (for
                            use by editors)
        --to-csn            Generate original model as CSN to "csn.json"

  Backward compatibility options (deprecated, do not use)
        --check-model       Perform extra checks on the model
        --oldstyle-self     Allow "self" alternatively to "$self" (implied by --tnt-flavor)
        --tnt-flavor        Compile with backward compatibility for the "TNT" project
        --tnt-csn           Generate TNT-specific post-processed CSN

  Diagnostic options
        --trace-parser      Trace parser
        --trace-parser-amb  Trace parser ambiguities
        --trace-fs          Trace file system access caused by "using from"

  Internal options (for testing only, may be changed/removed at any time)
    -R, --raw-output        Write raw augmented CSN and error output to stdout
        --beta-mode         Enable unsupported, incomplete (beta) features
        --hana-flavor       Compile with backward compatibility for HANA CDS (incomplete)
        --parse-only        Stop compilation after parsing and write result to stdout
        --to-extensions     Generate augmented CSN for extensions from properties file
        --test-mode         Produce extra-stable output for automated tests (normalize filenames
                            in errors, sort properties in CSN, omit version in CSN)
        --extra-augment     Compile to plain CSN, augment and compile again, augmentation tests
        --re-augmented      Re-augmented CSN and error output
        --omit-record-type  Omit unnecessary type attribute for ODATA records
```

## Some helpful hints

Please note the following general concepts regarding the new command line
- All `--to-...` options are orthogonal, i.e. they may be freely combined to generate multiple kinds of output with one invocation.
- When no `--to-...` options at all are specified, the behavior is still the same as `cdsv` (generate CSN output to `stdout`).
- When no `--out` option is provided or if `-` is specified as output directory , all output will go to `<stdout>` instead of
  being written to files - this is helpful for manual testing.
- The `--raw-output` option also affects all `--to-...` options where a CSN file is generated. Instead of `csn.json`, a `csn_raw.txt`
  will be produced.

## Migration guide

The following table shows replacements for some common `cdsv` options

| Old command line        | New command line                           |
| -------------------------- | --------------------------------------------- |
| `cdsv --odata-and-hana-output ...` | `cdsc --to-odata xml,json,separate,combined,csn --to-hana src ...` |
| `cdsv --odata-and-hana-output --odata-only ...` | `cdsc --to-odata xml,json,separate,combined,csn ...` |
| `cdsv --odata-and-hana-output --odata-only --odatav4 ...` | `cdsc --to-odata v4,xml,json,separate,combined,csn src ...` |
| `cdsv --odata-preprocess ...` | `cdsc --to-odata csn ...` |
| `cdsv --odata-preprocess --odatav4 ...` | `cdsc --to-odata csn,v4 ...` |
| `cdsv --to-hana ...` | `cdsc --to-hana src --out - ...` |
| `cdsv --hana-preprocess ...` | `cdsc --to-hana csn ...` |
| `cdsv --export-annotations ...` | `cdsc --to-i18n prop ...` |
| `cdsv --export-annos-ui5-style ...` | `cdsc --to-i18n ui5 ...` |
| `cdsv --cdl-output ...` | `cdsc --to-cdl ...` |
| `cdsv --to-sql ...` | `cdsc --to-sql src ...` |
| `cdsv --tnt-output foo ...` | `cdsc --out foo --tnt-flavor --to-odata v2,xml,separate --tnt-csn ...` |

## Changes in behavior

The following changes have been made to `cdsc` (all affecting ODATA output).
- ODATA output is generated either for V2 or for V4, with identical filenames (i.e. the suffix `_v4` no longer appears in filenames).
- The ODATA files `metadata.xml` and `annotations.xml` are no longer produced (`cdsv` only produced them if there was exactly one
  service in the model). Note that you can still produce `<service>_metadata.xml` and `<service>_annotations.xml` per service by
  specifiying the flag `separate` for `--to-odata` .
- The former ODATA output file `csn.json` is now named `odata_csn.json`, to avoid the name clash with the output of `--to-csn`,
  which is now `csn.json`.
- The content of ODATA output files for V2 is now equivalent to the new API results for V2 (`cdsv` produced the separate `annotations.xml`
  file with `V4` even if `V2` was specified, resulting in slightly different output. The `combined.xml` file always had the correct versioning).
