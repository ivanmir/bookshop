/**
 * This module is used for parsing csn as json and returned as augmented CSN.
 * @param source json formatted string representation of the csn
 * @param file name if the originating file - used for error reporting
 * @param options augmentor options
 */

function fromJson(source, filename, options) {
  let augmentor = require("./augmentor.js");
  let augmentor3 = require("./augmentor3.js");
  let jlParser = require("./parse")

  // parse json with locations
  let augmentedJSON = jlParser.parse( source, filename );

  let model = augmentedJSON.condense();

  // CSN validation
  let validateCSN = require("./schema/validateCSN.js");
  validateCSN(model, options);

  // augment CSN

  if(model.version && model.version.csn === "0.1.99" || options && options.newCsn)
    augmentor3.augment(model);
  else
    augmentor.augment(model , filename, options );
  delete model["locations"];
  return model;
}

module.exports = fromJson
